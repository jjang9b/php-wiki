<!DOCTYPE html>
<html>
<head>
</head>
<body>
<span style="color: #000000;"><strong>Server<br /><br /></strong>&lt;?php</span><br /><span style="color: #000000;">$sEnerKey = uniqid();</span><br /><span style="color: #000000;">$nEner = 10000;</span><br /><span style="color: #000000;">$nEnerCur = 10000;</span><br /><span style="color: #000000;">$nChar = 30;</span><br /><br /><span style="color: #000000;">for($i=0,$j=$nChar;$i&lt;$j;$i++)</span><br /><span style="color: #000000;">{</span><br /><span style="color: #000000;"> $aChar[$i]['att'] = rand(1, 10);</span><br /><span style="color: #000000;"> $aChar[$i]['spee'] = rand(1, 3);</span><br /><span style="color: #000000;">}</span><br /><br /><span style="color: #000000;">while($nEnerCur &gt; 0)</span><br /><span style="color: #000000;">{</span><br /><span style="color: #000000;"> for($i=0, $j=count($aChar);$i&lt;$j;$i++)</span><br /><span style="color: #000000;"> {</span><br /><span style="color: #000000;"> $nEnerCur -= $aChar[$i]['att'];</span><br /><span style="color: #000000;"> }</span><br /><span style="color: #000000;">}</span><br /><br /><span style="color: #000000;">$oData = array(</span><br /><span style="color: #000000;"> 'nEner'=&gt;$nEner,</span><br /><span style="color: #000000;"> 'sEnerKey'=&gt;$sEnerKey,</span><br /><span style="color: #000000;"> 'aChar'=&gt;$aChar</span><br /><span style="color: #000000;">);</span><br /><br /><span style="color: #000000;">echo json_encode($oData, JSON_UNESCAPED_UNICODE);</span><br /><br /><br /><span style="color: #000000;"><strong>HTML<br /><br /></strong>&lt;!DOCTYPE&gt;</span><br /><span style="color: #000000;">&lt;html&gt;</span><br /><span style="color: #000000;">&lt;head&gt;</span><br /><span style="color: #000000;"> &lt;script src="jquery.min.js"&gt;&lt;/script&gt;</span><br /><span style="color: #000000;"> &lt;script src="1.js"&gt;&lt;/script&gt;</span><br /><span style="color: #000000;"> &lt;link href="bootstrap.min.css" rel="stylesheet" type="text/css" /&gt;</span><br /><span style="color: #000000;">&lt;/head&gt;</span><br /><span style="color: #000000;">&lt;body&gt;</span><br /><span style="color: #000000;"> &lt;div class="col-xs-6"&gt;</span><br /><span style="color: #000000;"> &lt;div class="box-header"&gt;</span><br /><span style="color: #000000;"> Ener</span><br /><span style="color: #000000;"> &lt;/div&gt;</span><br /><span style="color: #000000;"> &lt;div class="box-body"&gt;</span><br /><span style="color: #000000;">&lt;pre id="p_ener" class="text-muted well well-sm no-shadow" style="height:50px;"&gt;</span><br /><span style="color: #000000;">&lt;/pre&gt;</span><br /><span style="color: #000000;">&lt;pre id="p_ener_time" class="text-muted well well-sm no-shadow" style="height:50px;"&gt;</span><br /><span style="color: #000000;">&lt;/pre&gt;</span><br /><span style="color: #000000;"> &lt;/div&gt;</span><br /><span style="color: #000000;"> &lt;/div&gt;</span><br /><span style="color: #000000;"> &lt;/div&gt;</span><br /><span style="color: #000000;"> &lt;div class="col-xs-6"&gt;</span><br /><span style="color: #000000;"> &lt;div class="box-header"&gt;</span><br /><span style="color: #000000;"> User</span><br /><span style="color: #000000;"> &lt;/div&gt;</span><br /><span style="color: #000000;"> &lt;div class="box-body"&gt;</span><br /><span style="color: #000000;">&lt;pre id="p_user" class="text-muted well well-sm no-shadow" style="height:510px;overflow:scroll"&gt;</span><br /><span style="color: #000000;">&lt;/pre&gt;</span><br /><span style="color: #000000;"> &lt;/div&gt;</span><br /><span style="color: #000000;"> &lt;/div&gt;</span><br /><span style="color: #000000;"> &lt;/div&gt;</span><br /><span style="color: #000000;">&lt;/body&gt;</span><br /><span style="color: #000000;">&lt;/html&gt;</span><br /><br /><span style="color: #000000;"><b>JS<br /><br /></b>(function(){</span><br /><br /><span style="color: #000000;"> var uApi = 'http://de-php-api.fttinc.kr/~bbin/private/it/fi.php';</span><br /><span style="color: #000000;"> var aChar = [];</span><br /><br /><span style="color: #000000;"> function f( ret ){</span><br /><span style="color: #000000;"> window.nEner = [];</span><br /><span style="color: #000000;"> window.nEner[ ret.sEnerKey ] = [];</span><br /><span style="color: #000000;"> window.nEner[ ret.sEnerKey ][ 'hp' ] = parseInt(ret.nEner);</span><br /><span style="color: #000000;"> var aChar = [];</span><br /><br /><span style="color: #000000;"> window.nEner[ ret.sEnerKey ][ 'stime' ] = new Date().getTime();</span><br /><span style="color: #000000;"> for(var i in ret.aChar){</span><br /><span style="color: #000000;"> (function(){</span><br /><span style="color: #000000;"> var nIdx = i</span><br /><span style="color: #000000;"> , nSpee = []</span><br /><span style="color: #000000;"> , nAtt = [];</span><br /><br /><span style="color: #000000;"> nSpee[ nIdx ] = parseInt( ret.aChar[ nIdx ].spee ) * 500;</span><br /><span style="color: #000000;"> nAtt[ nIdx ] = parseInt( ret.aChar[ nIdx ].att ) * 10;</span><br /><br /><span style="color: #000000;"> aChar[ nIdx ] = [];</span><br /><br /><span style="color: #000000;"> aChar[ nIdx ][ 'intv' ] = setInterval(function(){</span><br /><span style="color: #000000;"> window.nEner[ ret.sEnerKey ][ 'hp' ] -= nAtt[ nIdx ];</span><br /><br /><span style="color: #000000;"> if( window.nEner[ ret.sEnerKey ][ 'end' ] || ( window.nEner[ ret.sEnerKey ][ 'hp' ] - nAtt[ nIdx ] ) &lt; 0 ){</span><br /><span style="color: #000000;"> clearInterval( aChar[ nIdx ][ 'intv' ] );</span><br /><br /><span style="color: #000000;"> if(!window.nEner[ ret.sEnerKey ][ 'end' ]){</span><br /><span style="color: #000000;"> window.nEner[ ret.sEnerKey ][ 'etime' ] = new Date().getTime();</span><br /><span style="color: #000000;"> var sSpendTime = ( window.nEner[ ret.sEnerKey ][ 'etime' ] - window.nEner[ ret.sEnerKey ][ 'stime' ] ) / Math.floor(1000);</span><br /><span style="color: #000000;"> $( '#p_ener_time' ).html( sSpendTime + ' ms' );</span><br /><span style="color: #000000;"> }</span><br /><br /><span style="color: #000000;"> window.nEner[ ret.sEnerKey ][ 'end' ] = true;</span><br /><span style="color: #000000;"> }</span><br /><br /><span style="color: #000000;"> $( '#p_user' ).append( nIdx + " Att : " + nAtt[ nIdx ] + ', Speed : ' + nSpee[ nIdx ] + '&lt;br /&gt;' );</span><br /><span style="color: #000000;"> $( '#p_ener' ).html( window.nEner[ ret.sEnerKey ][ 'hp' ] );</span><br /><span style="color: #000000;"> }, nSpee[ nIdx ]);</span><br /><br /><span style="color: #000000;"> })();</span><br /><span style="color: #000000;"> }</span><br /><span style="color: #000000;"> };</span><br /><br /><span style="color: #000000;"> $.post(uApi, {}, function( ret ){</span><br /><span style="color: #000000;"> f( ret );</span><br /><span style="color: #000000;"> }, 'json');</span><br /><br /><span style="color: #000000;">})();<b><br /></b></span>
</body>
</html>